# Crypto Dashboard - Deployment Guide

## Overview
This Flask application now includes database functionality to store CSV download records. The app tracks every CSV download with metadata like filename, download time, file size, and crypto count.

## Features Added
- ✅ PostgreSQL database integration with SQLAlchemy
- ✅ Download record tracking in database
- ✅ Download history page with beautiful UI
- ✅ Database models for storing CSV metadata
- ✅ API endpoints for history data
- ✅ Responsive design for mobile devices

## Local Development Setup

### 1. Install Dependencies
```bash
pip install -r requirements.txt
```

### 2. Set Up Environment Variables
Copy `.env.example` to `.env` and update the values:
```bash
cp .env.example .env
```

Edit `.env` with your local database settings:
```
DATABASE_URL=postgresql://username:password@localhost:5432/crypto_dashboard
FLASK_ENV=development
SECRET_KEY=your-secret-key-here
```

### 3. Set Up Local PostgreSQL Database
```bash
# Install PostgreSQL (if not already installed)
# Create database
createdb crypto_dashboard

# Create user (optional)
createuser -s crypto_user
```

### 4. Run the Application
```bash
python app.py
```

The app will automatically create database tables on first run.

## Render.com Deployment Guide

### Step 1: Prepare Your Repository
1. Push your code to GitHub/GitLab
2. Ensure all files are committed:
   - `app.py` (updated with database functionality)
   - `requirements.txt` (with new dependencies)
   - `render.yaml` (with database configuration)
   - `templates/history.html` (new template)
   - `.env.example` (environment variables template)

### Step 2: Deploy on Render.com

#### Option A: Using render.yaml (Recommended)
1. Go to [Render.com](https://render.com)
2. Sign up/Login with your GitHub account
3. Click "New" → "Blueprint"
4. Connect your repository
5. Render will automatically detect `render.yaml` and create:
   - Web service (Flask app)
   - PostgreSQL database
   - Environment variables

#### Option B: Manual Setup
1. **Create PostgreSQL Database:**
   - Go to Render Dashboard
   - Click "New" → "PostgreSQL"
   - Choose "Free" plan
   - Name: `crypto-dashboard-db`
   - Note the connection details

2. **Create Web Service:**
   - Click "New" → "Web Service"
   - Connect your repository
   - Configure:
     - **Name:** `flask-crypto-dashboard`
     - **Environment:** `Python 3`
     - **Build Command:** `pip install -r requirements.txt`
     - **Start Command:** `gunicorn app:app`
     - **Plan:** Free

3. **Set Environment Variables:**
   - `PYTHON_VERSION`: `3.11.0`
   - `SECRET_KEY`: Generate a random secret key
   - `DATABASE_URL`: Copy from your PostgreSQL service

### Step 3: Verify Deployment
1. Wait for deployment to complete (5-10 minutes)
2. Visit your app URL
3. Test the dashboard functionality
4. Download a CSV file
5. Check the history page to verify database storage

## Database Schema

### DownloadRecord Table
```sql
CREATE TABLE download_record (
    id SERIAL PRIMARY KEY,
    download_id VARCHAR(36) UNIQUE NOT NULL,
    filename VARCHAR(255) NOT NULL,
    download_time TIMESTAMP NOT NULL DEFAULT NOW(),
    file_size INTEGER,
    crypto_count INTEGER NOT NULL
);
```

## API Endpoints

### New Endpoints Added:
- `GET /api/download-history` - Returns download history as JSON
- `GET /history` - History page with UI

### Existing Endpoints (Enhanced):
- `GET /download-csv` - Now stores download record in database
- `GET /api/crypto-prices` - Unchanged
- `GET /dashboard` - Now includes history link

## Environment Variables

### Required for Production:
- `DATABASE_URL` - PostgreSQL connection string (auto-provided by Render)
- `SECRET_KEY` - Flask secret key (auto-generated by Render)

### Optional:
- `FLASK_ENV` - Set to `production` for production deployment

## Troubleshooting

### Common Issues:

1. **Database Connection Error:**
   - Verify `DATABASE_URL` is correctly set
   - Check if PostgreSQL service is running
   - Ensure database exists

2. **Import Errors:**
   - Verify all dependencies are in `requirements.txt`
   - Check Python version compatibility

3. **Build Failures:**
   - Check `render.yaml` syntax
   - Verify all file paths are correct
   - Ensure no missing dependencies

### Debug Commands:
```bash
# Check database connection
python -c "from app import db; print('DB connected:', db.engine.url)"

# View database tables
python -c "from app import db; print(db.metadata.tables.keys())"
```

## Security Considerations

1. **Environment Variables:** Never commit `.env` files
2. **Secret Key:** Use a strong, random secret key in production
3. **Database Access:** Render automatically secures database connections
4. **HTTPS:** Render provides SSL certificates automatically

## Monitoring and Maintenance

1. **Logs:** Check Render dashboard for application logs
2. **Database:** Monitor database usage in Render dashboard
3. **Performance:** Use Render's built-in monitoring tools
4. **Updates:** Regularly update dependencies for security

## Cost Considerations

- **Free Tier Limits:**
  - Web service: 750 hours/month
  - PostgreSQL: 1GB storage, 1GB RAM
  - Automatic sleep after 15 minutes of inactivity

- **Upgrade Options:**
  - Starter plan: $7/month for always-on service
  - Standard plan: $25/month for better performance

## Next Steps

1. **Custom Domain:** Add your own domain in Render settings
2. **Monitoring:** Set up external monitoring (UptimeRobot, etc.)
3. **Backup:** Configure database backups
4. **Scaling:** Upgrade plans as your app grows

## Support

- Render Documentation: https://render.com/docs
- Flask-SQLAlchemy Docs: https://flask-sqlalchemy.palletsprojects.com/
- PostgreSQL Docs: https://www.postgresql.org/docs/
